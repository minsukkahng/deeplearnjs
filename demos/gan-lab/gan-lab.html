<link rel="import" href="../node_modules/@bower_components/polymer/polymer.html">
<link rel="import" href="../node_modules/@bower_components/paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="../node_modules/@bower_components/paper-slider/paper-slider.html">
<link rel="import" href="../node_modules/@bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../node_modules/@bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../node_modules/@bower_components/paper-item/paper-item.html">
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.blue_grey-blue.min.css" />

<script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.bundle.min.js"></script>

<dom-module id="gan-lab">
  <style>
    #gan-lab-container {
      display: flex;
      width: 100%;
    }

    .ink-panel {
      display: flex;
      flex-direction: column;
      font-size: 14px;
    }

    .side-panel {
      background: #fafafa;
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-width: 0 1px 0 0;
      padding: 20px;
    }

    #training-menu {
      width: 165px;
    }

    #model-visualization-container {
      background: #fafafa;
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-width: 0 1px 0 0;
      flex-grow: 2;
      padding: 20px;
      position: relative;
    }

    #visualization-container {
      flex-grow: 2;
      padding: 20px;
      position: relative;
    }

    #right-menu {
      border-width: 0 0 0 1px;
      width: 240px;
    }

    #model-vis-div {
      height: 800px;
      width: 500px;
    }

    .model-component {
      height: 90px;
      position: absolute;
      text-align: center;
      width: 80px;
    }

    .model-component svg {
      border: 1px solid #ddd;
      height: 80px;
      width: 80px;
    }

    .model-component .component-label {
      font-size: 12px;
      line-height: 16px;
    }

    .model-component-options {
      height: 90px;
      position: absolute;
      width: 140px;
    }

    .config-item {
      margin: 0;
    }

    .config-item label {
      color: #737373;
      margin: 0;
      font-size: 11px;
    }

    #model-visualization-container .mdl-button--icon {
      min-width: 16px;
      width: 16px;
    }

    #model-visualization-container .material-icons {
      font-size: 16px;
    }

    #model-visualization-container .paper-input-container input.paper-input,
    #model-visualization-container paper-item {
      font-size: 12px;
    }

    paper-slider {
      width: 80px;
    }

    .panel-title {
      color: #999;
      font-size: 12px;
      margin-top: 10px;
      text-transform: uppercase;
    }

    .timeline-controls {
      align-items: center;
      display: flex;
      margin-bottom: 10px;
      width: 140px;
    }

    #play-pause-button .material-icons {
      color: white;
      font-size: 36px;
      transform: translate(-18px,-12px);
    }

    #play-pause-button .material-icons:nth-of-type(2) {
      display: none;
    }

    #play-pause-button.playing .material-icons:nth-of-type(1) {
      display: none;
    }

    #play-pause-button.playing .material-icons:nth-of-type(2) {
      display: inherit;
    }

    .two-way-toggle {
      font-size: 12px;
      position: absolute;
    }

    #iteration {
      color: #737373;
      margin-top: 15px;
    }

    #iteration-count {
      margin-left: 5px;
      font-size: 32px;
    }

    #drawing-container {
      background: #fff;
      border-radius: 5px;
      display: none;
      padding: 10px;
      position: absolute;
    }

    #drawing-disable-background {
      background: rgba(0, 0, 0, 0.5);
      display: none;
      height: 100%;
      left: 0;
      position: absolute;
      top: 0;
      width: 100%;
    }

    #vis-descriptions text {
      fill: #737373;
      font-size: 12px;
    }

    .plot-bg {
      fill: #f3f3f3;
    }

    .plot-border {
      fill: none;
      stroke: #eee;
    }

    .true-dot {
      fill: rgba(0, 136, 55, 0.75);
    }

    .generated-dot, .noise-dot {
      fill: rgba(123, 50, 148, 0.75);
    }

    .uniform-generated-dot {
      fill: rgba(48, 48, 48, 0.5);
    }

    .manifold-cell {
      stroke: rgba(160, 160, 160, 0.25);
    }

    .gradient-generated {
      fill: none;
    }

    .contour {
      fill: none;
      opacity: 0.5;
      stroke: #bbb;
      stroke-width: 0.5;
      stroke-linejoin: round;
    }
  </style>
  <template>
    <div id="gan-lab-container">
      <div id="model-visualization-container" class="ink-panel">
        <div id="model-vis-div">
          <div class="panel-title">model</div>

          <div id="component-prediction" class="model-component"
            style="top: 20px; left: 215px">
            <svg id="component-svg-prediction"></svg>
            <div class="component-label">prediction</div>
          </div>

          <div id="component-d-loss" class="model-component"
            style="top: 20px; left: 380px">
            <div id="d-loss-value" class="component-value">-</div>
            <div class="component-label">D loss</div>
            <div class="config-item">
              <label># Updates per Iter: <span id="k-d-steps">2</span></label>
              <paper-slider pin min="0" max="10" value="2" id="k-d-steps-slider"></paper-slider>
            </div>
          </div>

          <div id="component-g-loss" class="model-component"
            style="top: 20px; left: 490px">
            <div id="g-loss-value" class="component-value">-</div>
            <div class="component-label">G loss</div>
            <div class="config-item">
              <label># Updates per Iter: <span id="k-g-steps">1</span></label>
              <paper-slider pin min="0" max="10" value="1" id="k-g-steps-slider"></paper-slider>
            </div>
          </div>

          <div id="component-discriminator" class="model-component"
            style="top: 170px; left: 215px">
            <div id="overlap-toggle" class="two-way-toggle">
              <paper-toggle-button id="overlap-plots" checked></paper-toggle-button>
            </div>
            <svg id="component-svg-discriminator-output"></svg>
            <div class="component-label">discriminator</div>
          </div>

          <div id="component-options-discriminator" class="model-component-options"
            style="top: 200px; left: 75px">
            <div class="config-item">
              <button class="mdl-button mdl-js-button mdl-button--icon"
                id="d-layers-add-button" title="Add a layer">
                <i class="material-icons">add</i>
              </button>
              <button class="mdl-button mdl-js-button mdl-button--icon"
                id="d-layers-remove-button" title="Remove a layer">
                <i class="material-icons">remove</i>
              </button>
              <label><span id="num-d-layers">1</span> hidden layer(s)</label>
            </div>
            <div class="config-item">
              <button class="mdl-button mdl-js-button mdl-button--icon"
                id="d-neurons-add-button" title="Add a neuron for each layer">
                <i class="material-icons">add</i>
              </button>
              <button class="mdl-button mdl-js-button mdl-button--icon"
                id="d-neurons-remove-button" title="Remove a neuron for each layer">
                <i class="material-icons">remove</i>
              </button>
              <label><span id="num-d-neurons">8</span> neuron(s)</label>
            </div>
          </div>

          <div id="component-discriminator-gradients" class="model-component"
            style="top: 170px; left: 345px">
            <svg id="component-svg-discriminator-gradients"></svg>
            <div class="component-label">gradients</div>
            <div class="config-item">
              <paper-dropdown-menu no-animations label="Learning Rate">
                <paper-listbox attr-for-selected="value" id="learning-rate-dropdown" class="dropdown-content" selected="{{learningRate}}">
                  <template is="dom-repeat" items="[[learningRateOptions]]">
                    <paper-item value="[[item]]" label="[[item]]">
                      [[item]]
                    </paper-item>
                  </template>
                </paper-listbox>
              </paper-dropdown-menu>
            </div>
          </div>

          <div id="component-true-distribution" class="model-component"
            style="top: 320px; left: 10px">
            <div id="t-contour-toggle" class="two-way-toggle">
              <paper-toggle-button id="show-t-contour" checked></paper-toggle-button>
            </div>
            <svg id="component-svg-true-distribution"></svg>
            <div class="component-label">true distribution</div>
            <div>
              <paper-dropdown-menu no-animations>
                <paper-listbox attr-for-selected="value" id="shape-dropdown" class="dropdown-content" selected="{{selectedShapeName}}">
                  <template is="dom-repeat" items="[[shapeNames]]">
                    <paper-item value="[[item]]" label="[[item]]">
                      [[item]]
                    </paper-item>
                  </template>
                </paper-listbox>
              </paper-dropdown-menu>
            </div>
          </div>

          <div id="component-real-samples" class="model-component"
            style="top: 320px; left: 150px">
            <div id="t-samples-toggle" class="two-way-toggle">
              <paper-toggle-button id="show-t-samples" checked></paper-toggle-button>
            </div>
            <svg id="component-svg-real-samples"></svg>
            <div class="component-label">real samples</div>
          </div>

          <div id="component-generated-samples" class="model-component"
            style="top: 320px; left: 290px">
            <div id="g-samples-toggle" class="two-way-toggle">
              <paper-toggle-button id="show-g-samples" checked></paper-toggle-button>
            </div>
            <svg id="component-svg-generated-samples"></svg>
            <div class="component-label">generated samples</div>
          </div>

          <div id="component-generator" class="model-component"
            style="top: 470px; left: 290px">
            <div id="manifold-toggle" class="two-way-toggle">
              <paper-toggle-button id="enable-manifold" checked></paper-toggle-button>
            </div>
            <svg id="component-svg-generator-manifold"></svg>
            <div class="component-label">generator</div>
          </div>

          <div id="component-options-generator" class="model-component-options"
            style="top: 500px; left: 150px">
            <div class="config-item">
              <button class="mdl-button mdl-js-button mdl-button--icon"
                id="g-layers-add-button" title="Add a layer">
                <i class="material-icons">add</i>
              </button>
              <button class="mdl-button mdl-js-button mdl-button--icon"
                id="g-layers-remove-button" title="Remove a layer">
                <i class="material-icons">remove</i>
              </button>
              <label><span id="num-g-layers">1</span> hidden layer(s)</label>
            </div>
            <div class="config-item">
              <button class="mdl-button mdl-js-button mdl-button--icon"
                id="g-neurons-add-button" title="Add a neuron for each layer">
                <i class="material-icons">add</i>
              </button>
              <button class="mdl-button mdl-js-button mdl-button--icon"
                id="g-neurons-remove-button" title="Remove a neuron for each layer">
                <i class="material-icons">remove</i>
              </button>
              <label><span id="num-g-neurons">8</span> neuron(s)</label>
            </div>
          </div>

          <div id="component-generator-gradients" class="model-component"
            style="top: 470px; left: 430px">
            <svg id="component-svg-generator-gradients"></svg>
            <div class="component-label">gradients</div>
          </div>

          <div id="component-noise" class="model-component"
            style="top: 620px; left: 290px">
            <svg id="component-svg-noise"></svg>
            <div class="component-label">noise</div>
            <div class="config-item">
              <label>Dimension: <span id="noise-size">2</span></label>
              <paper-slider pin min="1" max="4" value="2" id="noise-slider"></paper-slider>
            </div>
          </div>

        </div>
      </div>

      <div id="training-menu" class="ink-panel side-panel">
        <div class="timeline-controls">
          <button class="mdl-button mdl-js-button mdl-button--icon ui-resetButton" id="reset-button" title="Reset the network">
            <i class="material-icons">replay</i>
          </button>
          <button class="mdl-button mdl-js-button mdl-button--fab mdl-button--colored ui-playButton" id="play-pause-button" title="Run/Pause">
            <i class="material-icons">play_arrow</i>
            <i class="material-icons">pause</i>
          </button>
          <button class="mdl-button mdl-js-button mdl-button--icon ui-stepButton" id="next-step-button" title="Step">
            <i class="material-icons">skip_next</i>
          </button>
          <button class="mdl-button mdl-js-button mdl-button--icon ui-stepButton" id="next-step-d-button" title="Step only discriminator">
            <i>D</i>
          </button>
          <button class="mdl-button mdl-js-button mdl-button--icon ui-stepButton" id="next-step-g-button" title="Step only generator">
            <i>G</i>
          </button>
        </div>

        <div class="separator"></div>

        <div id="iteration" class="config-item">
          Epoch: <span id="iteration-count">0</span>
        </div>
      </div>

      <div id="drawing-disable-background"></div>

      <div id="visualization-container" class="ink-panel">
        <svg id="vis-svg" width="420" height="530">
          <g id="vis-area" transform="translate(10,10)">
            <g id="vis-discriminator-output" class="vis-panel">
              <rect class="plot-bg" width="400" height="400" x="0" y="0"></rect>
            </g>
            <g id="vis-samples" class="vis-panel">
              <g id="vis-true-samples-contour" class="contour"></g>
              <g id="vis-true-samples"></g>
              <g id="vis-generated-samples"></g>
              <defs>
                <linearGradient id="arrow-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:rgba(235, 0, 145, 0.8);" />
                  <stop offset="100%" style="stop-color:rgba(231, 85, 178, 0.2);" />
                </linearGradient>
              </defs>
              <g id="vis-gradients-for-generated"></g>
              <g id="vis-manifold"></g>
              <rect class="plot-border" width="400" height="400" x="0" y="0"></rect>
            </g>
          </g>
          <g id="vis-descriptions" transform="translate(10,420)">
            <circle class="true-dot" r="2" transform="translate(5,5)"></circle>
            <text transform="translate(15,9)">Samples from true distribution</text>
            <circle class="generated-dot" r="2" transform="translate(5,25)"></circle>
            <text transform="translate(15,29)">Samples generated by the generator</text>

            <rect class="true-dot" width="10" height="10" transform="translate(1,50)"></rect>
            <text transform="translate(16,59)">
              Discriminator thinks samples in this region are from true distribution (real).
            </text>
            <rect class="generated-dot" width="10" height="10" transform="translate(1,70)"></rect>
            <text transform="translate(16,79)">
              Discriminator thinks samples in this region are from generators (fake).
            </text>
          </g>
        </svg>

        <div id="drawing-container">
          <canvas id="input-drawing-canvas" width="400" height="400"></canvas>
          <div id="drawing-instruction">Draw a distribution above, then click the apply button.</div>
          <button id="finish-drawing" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored">Apply</button>
        </div>
      </div>

      <div id="right-menu" class="ink-panel side-panel">
        <div class="separator">Charts:</div>

        <div id="chart-container">
          <canvas id="cost-chart" width="240" height="200"></canvas>
        </div>
        <div id="eval-chart-container">
          <canvas id="eval-chart" width="240" height="200"></canvas>
        </div>
      </div>
    </div>
  </template>
</dom-module>
